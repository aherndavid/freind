<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FREIND - Your AI Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #131413 0%, #4a1a6b 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: #1a1a1a;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            width: 100%;
            max-width: 800px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid #4a1a6b;
        }

        .header {
            background: linear-gradient(135deg, #131413 0%, #4a1a6b 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid #6b2d91;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
            letter-spacing: 2px;
            font-weight: 600;
        }

        .header p {
            font-size: 13px;
            opacity: 0.8;
        }

        .setup-section {
            background: #131413;
            padding: 15px;
            border-bottom: 1px solid #4a1a6b;
        }

        .setup-section.hidden {
            display: none;
        }

        .setup-section input {
            width: 100%;
            padding: 12px;
            border: 1px solid #4a1a6b;
            border-radius: 8px;
            font-size: 14px;
            background: #1a1a1a;
            color: white;
            margin-bottom: 10px;
        }

        .setup-section input::placeholder {
            color: #666;
        }

        .setup-section button {
            padding: 10px 20px;
            background: #6b2d91;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            transition: all 0.3s;
        }

        .setup-section button:hover {
            background: #8b3db3;
            transform: translateY(-2px);
        }

        .instruction {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #0d0d0d;
        }

        .chat-container::-webkit-scrollbar {
            width: 8px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: #131413;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: #4a1a6b;
            border-radius: 4px;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 14px 18px;
            border-radius: 15px;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #6b2d91 0%, #4a1a6b 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.assistant .message-content {
            background: #1a1a1a;
            color: #e0e0e0;
            border-bottom-left-radius: 5px;
            border: 1px solid #2a2a2a;
        }

        .controls {
            padding: 20px;
            background: #131413;
            border-top: 2px solid #4a1a6b;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .mic-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #6b2d91 0%, #4a1a6b 100%);
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(107, 45, 145, 0.4);
        }

        .mic-button:hover {
            background: linear-gradient(135deg, #8b3db3 0%, #6b2d91 100%);
            transform: scale(1.05);
        }

        .mic-button.listening {
            background: linear-gradient(135deg, #c2185b 0%, #e91e63 100%);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 4px 15px rgba(233, 30, 99, 0.4);
            }
            50% { 
                transform: scale(1.1); 
                box-shadow: 0 4px 25px rgba(233, 30, 99, 0.6);
            }
        }

        .status {
            flex: 1;
            padding: 12px;
            background: #1a1a1a;
            border-radius: 10px;
            font-size: 14px;
            color: #999;
            border: 1px solid #2a2a2a;
        }

        .sync-status {
            font-size: 11px;
            color: #6b2d91;
            margin-top: 4px;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .action-button {
            padding: 10px 18px;
            background: #2a2a2a;
            color: #999;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .action-button:hover {
            background: #3a3a3a;
            color: white;
            border-color: #4a1a6b;
        }

        .voice-select {
            padding: 10px 12px;
            background: #2a2a2a;
            color: #999;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .voice-select:hover {
            background: #3a3a3a;
            color: white;
            border-color: #4a1a6b;
        }

        .voice-select option {
            background: #1a1a1a;
            color: white;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 12px;
            color: #6b2d91;
            background: #131413;
            border-top: 1px solid #4a1a6b;
        }

        .loading.active {
            display: block;
        }

        .error {
            background: #4a1a1a;
            color: #ff6b6b;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 15px;
            display: none;
            border: 1px solid #6b2d2d;
        }

        .error.active {
            display: block;
        }

        .success {
            background: #1a3a1a;
            color: #6bff6b;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 15px;
            display: none;
            border: 1px solid #2d6b2d;
        }

        .success.active {
            display: block;
        }

        .audio-visualizer {
            display: none;
            padding: 20px;
            background: #131413;
            border-top: 1px solid #4a1a6b;
            text-align: center;
        }

        .audio-visualizer.active {
            display: block;
        }

        .bars-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 4px;
            height: 50px;
            margin: 10px 0;
        }

        .bar {
            width: 4px;
            background: linear-gradient(to top, #6b2d91, #8b3db3);
            border-radius: 2px;
            animation: pulse-bar 0.6s ease-in-out infinite;
        }

        .bar:nth-child(1) { animation-delay: 0s; }
        .bar:nth-child(2) { animation-delay: 0.1s; }
        .bar:nth-child(3) { animation-delay: 0.2s; }
        .bar:nth-child(4) { animation-delay: 0.3s; }
        .bar:nth-child(5) { animation-delay: 0.4s; }
        .bar:nth-child(6) { animation-delay: 0.2s; }
        .bar:nth-child(7) { animation-delay: 0.1s; }

        @keyframes pulse-bar {
            0%, 100% { height: 10px; }
            50% { height: 40px; }
        }

        .text-input-container {
            display: flex;
            gap: 10px;
            padding: 15px 20px 0 20px;
        }

        .text-input {
            flex: 1;
            padding: 12px;
            background: #1a1a1a;
            border: 1px solid #4a1a6b;
            border-radius: 10px;
            color: white;
            font-size: 14px;
        }

        .text-input::placeholder {
            color: #666;
        }

        .text-input:focus {
            outline: none;
            border-color: #6b2d91;
        }

        .send-button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #6b2d91 0%, #4a1a6b 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .send-button:hover {
            background: linear-gradient(135deg, #8b3db3 0%, #6b2d91 100%);
            transform: translateY(-2px);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>FREIND</h1>
            <p>Your AI Companion - Powered by Claude</p>
        </div>

        <div class="setup-section" id="apiSetup">
            <h3 style="color: white; margin-bottom: 10px;">Claude API Setup</h3>
            <input type="password" id="apiKeyInput" placeholder="Enter your Claude API key">
            <div class="instruction">Get your API key from: console.anthropic.com</div>
            <button onclick="saveApiKey()">Save API Key</button>
        </div>

        <div class="error" id="error"></div>
        <div class="success" id="success"></div>

        <div class="chat-container" id="chatContainer">
            <div class="message assistant">
                <div class="message-content">
                    Welcome to FREIND! I'm your AI companion. Enter your Claude API key above, then either click the microphone to speak or type your message below. Your conversations are saved locally in your browser.
                </div>
            </div>
        </div>

        <div class="loading" id="loading">
            <p>‚è≥ Processing...</p>
        </div>

        <div class="audio-visualizer" id="audioVisualizer">
            <p style="color: #6b2d91; margin-bottom: 10px;">üé§ Listening...</p>
            <div class="bars-container">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <p style="color: #999; font-size: 12px;">Speak now</p>
        </div>

        <div class="text-input-container">
            <input type="text" class="text-input" id="textInput" placeholder="Or type your message here..." />
            <button class="send-button" id="sendButton" onclick="sendTextMessage()">Send</button>
        </div>

        <div class="controls">
            <button class="mic-button" id="micButton" onclick="toggleListening()" disabled>
                üé§
            </button>
            <div class="status" id="status">
                Complete setup to begin
            </div>
            <div class="action-buttons">
                <select class="voice-select" id="voiceSelect" onchange="changeVoice()">
                    <option value="male">üéôÔ∏è Male</option>
                    <option value="female">üë© Female Soft</option>
                    <option value="sexy">üíã Female Sexy</option>
                    <option value="robot">ü§ñ Robot (WarGames)</option>
                </select>
                <button class="action-button" onclick="clearChat()">üóëÔ∏è Clear</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        let apiKey = localStorage.getItem('claudeApiKey') || '';
        let conversationHistory = JSON.parse(localStorage.getItem('conversationHistory') || '[]');
        let isListening = false;
        let recognition = null;
        let synthesis = window.speechSynthesis;
        let currentVoice = 'male';
        let voiceSettings = {
            male: { rate: 0.95, pitch: 0.8, voiceName: null },
            female: { rate: 0.9, pitch: 1.3, voiceName: null },
            sexy: { rate: 0.85, pitch: 1.5, voiceName: null },
            robot: { rate: 0.7, pitch: 0.5, voiceName: null }
        };

        // Initialize
        window.onload = function() {
            setupSpeechRecognition();
            checkSetupStatus();
            
            // Load saved voice preference
            const savedVoice = localStorage.getItem('selectedVoice');
            if (savedVoice) {
                currentVoice = savedVoice;
                document.getElementById('voiceSelect').value = savedVoice;
            }
            
            // Ensure voices are loaded
            if (synthesis.getVoices().length === 0) {
                synthesis.addEventListener('voiceschanged', function() {
                    console.log('Voices loaded');
                });
            }
        };

        function checkSetupStatus() {
            if (apiKey) {
                document.getElementById('apiSetup').classList.add('hidden');
                document.getElementById('micButton').disabled = false;
                showStatus('Click the microphone to start talking or type below');
                loadConversationHistory();
            }
        }

        function saveApiKey() {
            const input = document.getElementById('apiKeyInput');
            apiKey = input.value.trim();
            
            if (!apiKey) {
                showError('Please enter an API key');
                return;
            }

            localStorage.setItem('claudeApiKey', apiKey);
            showSuccess('API key saved! You can now start using FREIND.');
            checkSetupStatus();
        }

        function setupSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showError('Speech recognition not supported. Please use Chrome or Edge.');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onstart = function() {
                isListening = true;
                document.getElementById('micButton').classList.add('listening');
                document.getElementById('audioVisualizer').classList.add('active');
                showStatus('üé§ Listening... speak now');
            };

            recognition.onend = function() {
                isListening = false;
                document.getElementById('micButton').classList.remove('listening');
                document.getElementById('audioVisualizer').classList.remove('active');
                showStatus('Click the microphone to start talking');
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('audioVisualizer').classList.remove('active');
                showStatus('Processing your message...');
                addMessage('user', transcript);
                sendToClaudeAPI(transcript);
            };

            recognition.onerror = function(event) {
                showError('Speech recognition error: ' + event.error);
                isListening = false;
                document.getElementById('micButton').classList.remove('listening');
                document.getElementById('audioVisualizer').classList.remove('active');
            };
        }

        function sendTextMessage() {
            const textInput = document.getElementById('textInput');
            const message = textInput.value.trim();
            
            if (!message) {
                showError('Please type a message');
                return;
            }
            
            if (!apiKey) {
                showError('Please enter your API key first');
                return;
            }
            
            addMessage('user', message);
            sendToClaudeAPI(message);
            textInput.value = '';
        }

        // Allow Enter key to send message
        window.addEventListener('DOMContentLoaded', function() {
            const textInput = document.getElementById('textInput');
            if (textInput) {
                textInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        sendTextMessage();
                    }
                });
            }
        });

        function toggleListening() {
            if (!apiKey) {
                showError('Please enter your API key first');
                return;
            }

            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        async function sendToClaudeAPI(message) {
            document.getElementById('loading').classList.add('active');

            conversationHistory.push({
                role: 'user',
                content: message
            });

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1024,
                        messages: conversationHistory
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'API request failed');
                }

                const data = await response.json();
                const assistantMessage = data.content[0].text;

                conversationHistory.push({
                    role: 'assistant',
                    content: assistantMessage
                });

                addMessage('assistant', assistantMessage);
                speak(assistantMessage);
                
                // Save to localStorage
                localStorage.setItem('conversationHistory', JSON.stringify(conversationHistory));

            } catch (error) {
                showError('Error: ' + error.message);
                conversationHistory.pop();
            } finally {
                document.getElementById('loading').classList.remove('active');
            }
        }

        function addMessage(role, content) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = content;
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function speak(text) {
            synthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            const settings = voiceSettings[currentVoice];
            
            utterance.rate = settings.rate;
            utterance.pitch = settings.pitch;
            utterance.volume = 1.0;
            
            // Get available voices
            const voices = synthesis.getVoices();
            
            // Voice selection logic
            if (currentVoice === 'male') {
                // Prefer male voices
                const maleVoice = voices.find(v => 
                    v.name.includes('Male') || 
                    v.name.includes('David') || 
                    v.name.includes('George') ||
                    v.name.includes('Guy')
                );
                if (maleVoice) utterance.voice = maleVoice;
            } else if (currentVoice === 'female') {
                // Soft female voice
                const femaleVoice = voices.find(v => 
                    v.name.includes('Female') || 
                    v.name.includes('Samantha') || 
                    v.name.includes('Victoria') ||
                    v.name.includes('Karen')
                );
                if (femaleVoice) utterance.voice = femaleVoice;
            } else if (currentVoice === 'sexy') {
                // Higher pitched female voice
                const sexyVoice = voices.find(v => 
                    v.name.includes('Female') || 
                    v.name.includes('Samantha') ||
                    v.name.includes('Zira') ||
                    v.name.includes('Vicki')
                );
                if (sexyVoice) utterance.voice = sexyVoice;
            } else if (currentVoice === 'robot') {
                // Robot voice - use any voice but with very low pitch and slow rate
                utterance.rate = 0.65;
                utterance.pitch = 0.3;
                // Prefer monotone voices
                const robotVoice = voices.find(v => 
                    v.name.includes('Alex') ||
                    v.name.includes('Fred') ||
                    v.name.includes('Junior')
                );
                if (robotVoice) utterance.voice = robotVoice;
            }
            
            synthesis.speak(utterance);
        }

        function changeVoice() {
            currentVoice = document.getElementById('voiceSelect').value;
            localStorage.setItem('selectedVoice', currentVoice);
            showSuccess('Voice changed to: ' + currentVoice);
        }

        function loadConversationHistory() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = '';
            
            if (conversationHistory.length === 0) {
                addMessage('assistant', "Hi! I'm FREIND, your AI companion. Click the microphone to speak or type your message below. Your conversations are saved locally in your browser!");
            } else {
                conversationHistory.forEach(msg => {
                    addMessage(msg.role, msg.content);
                });
            }
        }

        function clearChat() {
            if (confirm('Clear all conversations? This will delete your chat history.')) {
                conversationHistory = [];
                localStorage.setItem('conversationHistory', JSON.stringify(conversationHistory));
                const chatContainer = document.getElementById('chatContainer');
                chatContainer.innerHTML = '';
                addMessage('assistant', "Conversations cleared! How can I help you?");
            }
        }

        function showStatus(message) {
            document.getElementById('status').textContent = message;
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.add('active');
            setTimeout(() => errorDiv.classList.remove('active'), 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success');
            successDiv.textContent = message;
            successDiv.classList.add('active');
            setTimeout(() => successDiv.classList.remove('active'), 3000);
        }
    </script>
</body>
</html>
